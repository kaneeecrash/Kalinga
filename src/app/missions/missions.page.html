<ion-header>
  <ion-toolbar>
    <ion-title>Join Missions Now!</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Search + Filter -->
  <div class="toolbar ion-padding">
    <ion-searchbar placeholder="Search" (ionInput)="onSearchChange($event.detail.value)"></ion-searchbar>
    <ion-buttons slot="end">
      <ion-button (click)="openFilters()">
        <ion-icon name="filter-outline"></ion-icon>
      </ion-button>
      <ion-button (click)="openFilters()">
        <ion-icon name="calendar-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </div>

  <!-- Filters Overlay -->
  <ion-modal [isOpen]="filtersOpen" (didDismiss)="closeFilters()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Filter by</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeFilters()">Close</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-list>

            <ion-list-header>Sort</ion-list-header>
            <ion-item>
              <ion-segment [(ngModel)]="sortOrder">
                <ion-segment-button value="desc">Newest</ion-segment-button>
                <ion-segment-button value="asc">Oldest</ion-segment-button>
              </ion-segment>
            </ion-item>
          </ion-list>

          <ion-list-header>Services</ion-list-header>
          <ion-item *ngFor="let s of servicesOptions">
            <ion-checkbox slot="start" [checked]="selectedServices.includes(s)" (ionChange)="onToggleService(s, $event.detail.checked)"></ion-checkbox>
            <ion-label>{{ s }}</ion-label>
          </ion-item>


        <div class="ion-padding-top">
          <ion-button expand="block" (click)="applyFilters(); closeFilters()">Apply</ion-button>
          <ion-button expand="block" fill="clear" (click)="clearFilters()">Clear</ion-button>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

  <div class="ion-padding">
    <p class="campaign-count">
      WE HAVE TOTAL <b>{{ missions.length }} UPCOMING CAMPAIGNS</b>
    </p>
  </div>

  <ion-list *ngIf="filtered.length; else empty">
    <div class="mission-container" *ngFor="let m of filtered; trackBy: trackById">
      <ion-item lines="none">
        <ion-label>
          <h3 class="date">{{ m.date | date:'MMMM d, y' }}</h3>
          <h2 class="title">{{ m.name }} â€” {{ m.orgName }}</h2>
          <p class="icon"><ion-icon name="location-outline"></ion-icon>{{ m.location }}</p>
          <p class="icon"><ion-icon name="time-outline"></ion-icon>{{ formatTimeTo12Hour(m.startTime) }} - {{ formatTimeTo12Hour(m.endTime) }}</p>
          <p>ðŸ‘¥ Volunteers Needed: {{ m.volunteers }}</p>
        </ion-label>
      </ion-item>

      <!-- Actions for each mission -->
      <div class="actions">
        <ion-button size="small" fill="clear" color="success" (click)="joinMission(m.id)">
          I AM IN
        </ion-button>
        <ion-button size="small" fill="clear" [routerLink]="['/mission', m.id]">
          DETAILS
        </ion-button>
      </div>
    </div>
  </ion-list>

  <ng-template #empty>
    <div class="ion-padding ion-text-center">
      <ion-text color="medium">No missions found.</ion-text>
    </div>
  </ng-template>
</ion-content>
