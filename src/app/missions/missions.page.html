<ion-header>
  <ion-toolbar>
    <ion-title>Join Missions Now!</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Search + Filter -->
  <div class="toolbar ion-padding">
    <ion-searchbar placeholder="Search" (ionInput)="onSearchChange($event.detail.value)"></ion-searchbar>
    <ion-buttons slot="end">
      <ion-button (click)="openFilters()">
        <ion-icon name="filter-outline"></ion-icon>
      </ion-button>
      <ion-button (click)="openFilters()">
        <ion-icon name="calendar-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </div>

  <!-- Filters Overlay -->
  <ion-modal [isOpen]="filtersOpen" (didDismiss)="closeFilters()">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Filter by</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="closeFilters()">Close</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-list>

            <ion-list-header>Sort</ion-list-header>
            <ion-item>
              <ion-segment [(ngModel)]="sortOrder">
                <ion-segment-button value="desc">Newest</ion-segment-button>
                <ion-segment-button value="asc">Oldest</ion-segment-button>
              </ion-segment>
            </ion-item>
          </ion-list>

          <ion-list-header>Services</ion-list-header>
          <ion-item *ngFor="let s of servicesOptions">
            <ion-checkbox slot="start" [checked]="selectedServices.includes(s)" (ionChange)="onToggleService(s, $event.detail.checked)"></ion-checkbox>
            <ion-label>{{ s }}</ion-label>
          </ion-item>


        <div class="ion-padding-top">
          <ion-button expand="block" (click)="applyFilters(); closeFilters()">Apply</ion-button>
          <ion-button expand="block" fill="clear" (click)="clearFilters()">Clear</ion-button>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

  <div class="ion-padding">
    <p class="campaign-count">
      WE HAVE TOTAL <b>{{ missions.length }} UPCOMING CAMPAIGNS</b>
    </p>
  </div>

  <ion-list *ngIf="filtered.length; else empty">
    <div class="mission-card" *ngFor="let m of filtered; trackBy: trackById" [ngClass]="{'open': m.status?.toLowerCase() === 'open'}" (click)="goToMissionDetail(m.id)">
      <div class="mission-type">{{ m.missionName }}</div>
      <div class="mission-details">üìç{{ m.location }}</div>
      <div class="mission-datetime">‚è∞{{ m.date | date:'MMMM d, y' }} | {{ formatTimeTo12Hour(m.startTime) }} - {{ formatTimeTo12Hour(m.endTime) }}</div>
      <div class="mission-details">volunteers needed: {{ m.volunteers }}</div>
      <div class="mission-details">{{ m.orgName }}</div>
      <div class="mission-actions">
        <ion-button size="small" 
                    [color]="getButtonColor(m)" 
                    [disabled]="!canJoinMission(m)"
                    (click)="handleMissionAction(m, $event)">
          {{ getButtonText(m) }}
        </ion-button>
      </div>
    </div>
  </ion-list>

  <ng-template #empty>
    <div class="ion-padding ion-text-center">
      <ion-text color="medium">No missions found.</ion-text>
    </div>
  </ng-template>
</ion-content>
